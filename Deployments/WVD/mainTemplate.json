{
   "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "workspace":{
         "type":"string"
      },
	  "location": {
		 "type": "string",
			"defaultValue": "[resourceGroup().location]",
			"metadata": {
				"description": "Location for all resources."
			}
	  }
   },
   "resources":[
      {
         "apiVersion":"2019-05-01",
         "name":"pid-829f34d0-ff76-42d3-b46f-f527d50ff819",
         "type":"Microsoft.Resources/deployments",
         "subscriptionId":"[subscription().subscriptionId]",
         "resourceGroup":"[resourceGroup().name]",
         "properties":{
            "mode":"Incremental",
            "template":{
               "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
               "contentVersion":"1.0.0.0",
               "resources":[
                  
               ]
            }
         }
      },
      {
         "apiVersion":"2020-03-01-preview",
         "name":"[concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId))]",
         "type":"Microsoft.OperationalInsights/workspaces",
         "location": "[parameters('location')]",
         "id":"[resourceId('Microsoft.OperationalInsights/workspaces',concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]",
         "properties":{
            "sku":{
               "Name":"Standalone"
            },
            "retentionInDays":360
         },
         "resources":[
            
         ]
      },
      {
         "name":"f3c02d9d-aab8-43b6-9eb8-17ae3dfc11ad",
         "type":"microsoft.insights/workbooktemplates",
         "location": "[parameters('location')]",
         "apiVersion":"2019-10-17-preview",
         "properties":{
            "galleries":[
               {
                  "name":"WVD Insights",
                  "category":"Windows Virtual Desktop",
                  "order":100,
                  "type":"workbook",
                  "resourceType":"microsoft.operationalinsights/workspaces"
               }
            ],
            "templateData":"{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop Overview Workbook\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6a35dc35-14fe-4877-88ca-55047ca82196\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_showLicense\",\"type\":1,\"description\":\"If \\\"false\\\" the licensing tile is hidden\",\"value\":\"true\",\"isHiddenWhenLocked\":true},{\"id\":\"f1363193-d7e7-4724-a946-136fa480ecd2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_defaultAggBin\",\"type\":1,\"description\":\"Default aggretgation time for operations (normally 10m)\",\"value\":\"10m\",\"isHiddenWhenLocked\":true,\"timeContextFromParameter\":\"TimeRange\"},{\"id\":\"411f8853-3954-47d7-a645-cd371595ca0f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_ignoreHostPools4Licensing\",\"type\":1,\"description\":\"Users using this host pools are not summarized to calculate the license count: ['STAGING', 'DEMO']\",\"value\":\"['STAGING', 'DEMO']\",\"isHiddenWhenLocked\":true},{\"id\":\"390686f3-8df6-4120-8be5-422f4905e353\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_ignorePathAndApps\",\"type\":1,\"description\":\"Prevent showing applications containing this entries in theire path in application summaries.\",\"value\":\"['C:\\\\\\\\Windows\\\\\\\\system32\\\\\\\\','C:\\\\\\\\Program Files\\\\\\\\Citrix\\\\\\\\Personal vDisk\\\\\\\\','C:\\\\\\\\Program Files (x86)\\\\\\\\Citrix\\\\\\\\','WindowsInternal','csrss.exe','SearchUI.exe','csrss.exe','ShellExperienceHost.exe','SDXHelper.exe','splwow64.exe']\",\"isHiddenWhenLocked\":true}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.insights/components\"},\"name\":\"parameters - 45\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\n### The following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. All session hosts running the Azure Monitor for WVD Agent sending data to this Log Analytics workspace.\\r\\n\\r\\n(If not data are visualized install the Azure Monitor Agent for WVD from the \\\"Updates & Downloads\\\" tab at the bottom of this page)\"},\"customWidth\":\"80\",\"name\":\"text - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let _ignoreHostPools4Licensing=dynamic({_ignoreHostPools4Licensing});\\r\\nITPC_CTX_Session_CL | where TimeGenerated > startofmonth(ago(180d)) and TimeGenerated< startofmonth(now()) and  DesktopGroup_s !in (_ignoreHostPools4Licensing) | extend YearMonth=strcat(getyear(TimeGenerated),\\\".\\\",getmonth(TimeGenerated)) | summarize DistinctUsers=dcount(UserName_s) by YearMonth, WorkspaceId=TenantId | order by YearMonth desc | take 1| extend Send=strcat(\\\"https://csp-productscallback-prd.azurewebsites.net/api/Send2LogAnalytics?code=MW/lpAE5R5e8PvyxTFXsbDhxLGUkBauVtucx7a4Tnc0KERG/na3PAQ==&WorkspaceId=\\\",WorkspaceId,\\\"&YearMonth=\\\",YearMonth,\\\"&DistinctUsers=\\\",DistinctUsers)\",\"size\":4,\"title\":\"License information\",\"exportFieldName\":\"UserName\",\"exportParameterName\":\"_UserName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Send\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Send to sepago to change license count for this month\",\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"YearMonth\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Year.Month for the report\"}},\"leftContent\":{\"columnMatch\":\"DistinctUsers\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Count of licenses used for the last month\"}},\"secondaryContent\":{\"columnMatch\":\"Send\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Send to sepago\",\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Send the distinct user count for the last month to sepago to correct billing. Do this in the first five days of a month to correct the number for the last month. Only the workspace id, date, and distinct user count are submitted. Your workspace must be registered to match (send the workspace id to sales@sepago.de).\"}},\"showBorder\":false,\"rowLimit\":1}},\"customWidth\":\"20\",\"conditionalVisibility\":{\"parameterName\":\"_showLicense\",\"comparison\":\"isNotEqualTo\",\"value\":\"false\"},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let from=ago(5m);\\r\\nlet sessions=ITPC_CTX_Session_CL| where TimeGenerated > from\\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s;\\r\\nlet avgCPU=ITPC_CTX_PerfData_CL| where TimeGenerated>from and Category==\\\"Processor Information\\\" and Counter_s==\\\"% Processor Time\\\" and Instance_s==\\\"_Total\\\"|summarize CPU=avg(value_d) by Worker_s, DesktopGroup_s;\\r\\nlet avgMemFree=ITPC_CTX_PerfData_CL| where TimeGenerated>from and Category==\\\"Memory\\\" and Counter_s==\\\"Available Bytes\\\"|summarize MemFree=avg(value_d) by Worker_s;\\r\\nlet avgPaginUsage=ITPC_CTX_PerfData_CL| where TimeGenerated>from and Category==\\\"Paging File\\\" and Counter_s==\\\"% Usage\\\" and Instance_s==\\\"_Total\\\"|summarize PagingUsage=avg(value_d) by Worker_s;\\r\\nlet avgMemPhys=ITPC_CTX_Worker_CL| where TimeGenerated>ago(90m)| summarize MemPhys=avg(TotalPhysicalMemory_d) by Worker_s=Name_s;\\r\\navgCPU\\r\\n| join avgMemFree on Worker_s | join avgPaginUsage on Worker_s | join avgMemPhys on Worker_s\\r\\n| extend MemoryUsagePerc=(1-MemFree/MemPhys)*100| extend LoadIndex=(30 * MemoryUsagePerc + 20 * CPU + 1 * PagingUsage)/51, SessionHost=Worker_s\\r\\n| project-away Worker_s1,Worker_s2,Worker_s3,Worker_s\\r\\n| summarize MemFree=avg(MemFree), MemoryUsagePerc=avg(MemoryUsagePerc), LoadIndex=avg(LoadIndex), CPU=avg(CPU), PagingUsage=avg(PagingUsage) by HostPool=DesktopGroup_s\\r\\n| join sessions on HostPool\",\"size\":4,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"LoadIndex\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"orange\"},\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":1}},\"tooltipFormat\":{\"tooltip\":\"Loadindex of the host pool (0..100%)\"}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"showLegend\":true}},\"showPin\":true,\"name\":\"query - 5\"},{\"type\":1,\"content\":{\"json\":\"## Select a time range and a session host\\r\\nRefine your search by optionally select a specific session host or user. Note: Not all visualization can drill down to a single host or user. Use the **navigation tabs** to focus the view on the data.\"},\"name\":\"text - 16 - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":259200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"6e7ddca7-163c-4547-9e37-d408299ce828\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HostPool\",\"label\":\"Host Pool\",\"type\":2,\"description\":\"Select a host pool to show only data of this specific one\",\"isRequired\":true,\"query\":\"ITPC_CTX_Process_CL | distinct DesktopGroup_s | order by HostPool=DesktopGroup_s\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"SessionHostSelector\",\"label\":\"Session Host\",\"type\":2,\"description\":\"Select a session host to drill down into the data. Don't select a session host to disable this filter.\",\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" |distinct Worker_s | order by Worker_s\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"id\":\"682005d8-aaaf-495d-95b7-3b8dd7bb731c\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"UserSelector\",\"label\":\"User\",\"type\":2,\"description\":\"Select a user to drill down into the data. Don't select a user to disable this filter.\",\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s!=\\\"\\\" |distinct UserName_s | order by UserName_s\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"id\":\"fc314454-4e21-4e3e-8fdb-94f2088d70f9\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"9139c185-ab49-40cc-ae23-b434e19dacfb\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Sessions\",\"subTarget\":\"Sessions\",\"style\":\"link\"},{\"id\":\"c60b4d07-e355-4424-addd-5b87bcfd939c\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Session hosts\",\"subTarget\":\"SessionHosts\",\"style\":\"link\"},{\"id\":\"8a3f1042-f525-4465-990f-9a4dbbb75861\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Processes\",\"subTarget\":\"Processes\",\"style\":\"link\"},{\"id\":\"ffbafe15-f4ea-4000-93ed-3dad828e4714\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Applications and users\",\"subTarget\":\"Applications\",\"style\":\"link\"},{\"id\":\"7b0dd22f-a8ea-4059-8dab-a824fdd69128\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Updates & Donwloads\",\"subTarget\":\"Updates\",\"style\":\"link\"}]},\"name\":\"lnkMainSelector\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Sessions\\r\\nThe session tab shows information and data around the user sessions. This contains bandwidths, latencies and more grouped by different elements.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector}))| summarize dcount(SessionHash_s) by ConnectionState_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"title\":\"Active and disconnected sessions\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL  | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector}))\\r\\n|summarize Minutes=count() by User=UserName_s, SessionHash_s| summarize [\\\"# of distinct sessions\\\"]=dcount(SessionHash_s),[\\\"Total session time\\\"]=sum(Minutes).toint(), [\\\"Avg. session time\\\"]=avg(Minutes).toint(),[\\\"Shortes session time\\\"]=min(Minutes).toint(),[\\\"Highest session time\\\"]=max(Minutes).toint() by User\\r\\n| join kind=leftouter (\\r\\n    ITPC_CTX_Events_CL\\r\\n    | where Trigger_s ==\\\"Logon\\\" and EventType_s ==\\\"FSLogix\\\" and (Event_s==\\\"LoadProfile\\\" or Event_s ==\\\"Logon notification\\\") and TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector}))\\r\\n    | extend StartTime=datetime_add(\\\"Millisecond\\\",-tolong(Duration_d*1000),TimeGenerated)\\r\\n    | summarize min(StartTime), EndTime=max(TimeGenerated) by SessionHash_s,User=UserName_s,HostPool=DesktopGroup_s, SessionHash=SessionHash_s\\r\\n    | extend Duration=todouble(EndTime-min_StartTime)/10000000\\r\\n    | summarize [\\\"Time to desktop\\\"]=avg(Duration) by User\\r\\n) on User\\r\\n| join kind=leftouter (\\r\\n    ITPC_CTX_Events_CL\\r\\n    | where Trigger_s ==\\\"Info\\\" and EventType_s ==\\\"ProfileData\\\" and TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector}))\\r\\n    | summarize arg_max(TimeGenerated,MbyteFree_d) by User=UserName_s\\r\\n    | project [\\\"FSLogix Profile MByte free\\\"]=MbyteFree_d, User \\r\\n) on User\\r\\n| project-away User1, User2\\r\\n| order by User\\r\\n\\r\\n\",\"size\":0,\"title\":\"User sessions and runtime \",\"exportFieldName\":\"User\",\"exportParameterName\":\"Select_SessionsUserOverview\",\"exportDefaultValue\":\"\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Total session time\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Avg. session time\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Shortes session time\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Highest session time\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Time to desktop\",\"formatter\":8,\"formatOptions\":{\"min\":6,\"palette\":\"purple\"},\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}},\"tooltipFormat\":{\"tooltip\":\"Time for the login process to the session host to the expected time of showing the desktop or app. Note: GPO and login scripts could run longer in the background. Keep in mind that published applications don't report a valid number. \"}},{\"columnMatch\":\"FSLogix Profile MByte free\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\"},\"numberFormat\":{\"unit\":4,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}},\"tooltipFormat\":{\"tooltip\":\"Free space of the FSLogix profile disk\"}},{\"columnMatch\":\"Logon process\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Logon duration in sec.\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}},\"tooltipFormat\":{\"tooltip\":\"The logon duration includes FSLogix profile attachment, GPO load, GPO processing, and logon scripts. Keep in mind that the desktop can appear faster if the GPO runs asynchronously\"}},{\"columnMatch\":\"Logon duration\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}},\"tooltipFormat\":{\"tooltip\":\"The logon duration includes FSLogix profile attachment, GPO load, GPO processing, and logon scripts. Keep in mind that the desktop can appear faster if the GPO runs asynchronously\"}},{\"columnMatch\":\"Total session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Avg. session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Shortes session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Highest session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"User\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"User\",\"sortOrder\":1}]},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{Select_SessionsUserOverview}\\\"==UserName_s  and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})))\\r\\n| summarize [\\\"Session start\\\"]=min(LoginTime_t), [\\\"Session last recored\\\"]=max(TimeGenerated),Active=countif(ConnectionState_s ==\\\"Active\\\"),InActive=countif(ConnectionState_s !=\\\"Active\\\")  by User=UserName_s,SessionHost=Worker_s,Id=SessionHash_s\\r\\n| extend Runtime=datetime_diff(\\\"Minute\\\",[\\\"Session last recored\\\"],[\\\"Session start\\\"]),[\\\"Active time\\\"]=Active/(Active+InActive+0.0)*100\\r\\n| join kind=leftouter (\\r\\n    ITPC_CTX_Events_CL\\r\\n    | where Trigger_s ==\\\"Logon\\\" and EventType_s ==\\\"FSLogix\\\" and (Event_s==\\\"LoadProfile\\\" or Event_s ==\\\"Logon notification\\\") and TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector}))\\r\\n    | extend StartTime=datetime_add(\\\"Millisecond\\\",-tolong(Duration_d*1000),TimeGenerated)\\r\\n    | summarize min(StartTime), EndTime=max(TimeGenerated) by SessionHash_s,User=UserName_s,HostPool=DesktopGroup_s, Id=SessionHash_s\\r\\n    | extend Duration=todouble(EndTime-min_StartTime)/10000000\\r\\n    | summarize [\\\"Time to desktop\\\"]=avg(Duration) by Id\\r\\n) on Id\\r\\n| project-away Active,InActive, Id1\\r\\n| order by [\\\"Session start\\\"] desc\\r\\n\",\"size\":1,\"title\":\"Detailed logon data\",\"exportFieldName\":\"Id\",\"exportParameterName\":\"Select_SessionsSessionHashOverview\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Runtime\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"Active time\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}},\"tooltipFormat\":{\"tooltip\":\"Percentage of the time the user is connected and not in a disconnected mode\"}},{\"columnMatch\":\"Time to desktop\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}},\"tooltipFormat\":{\"tooltip\":\"Time for the login process to the session host to the expected time of showing the desktop or app. Note: GPO and login scripts could run longer in the background\"}}]},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"EventDetail\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Seconds\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":1}}}}},\"customWidth\":\"100\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},{\"parameterName\":\"Select_SessionsUserOverview\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Select_SessionsUserOverview\\r\\nITPC_CTX_Events_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{Select_SessionsSessionHashOverview}\\\"==SessionHash_s  and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})))\\r\\n| where Trigger_s ==\\\"Logon\\\" and UserName_s !=\\\"\\\"\\r\\n| extend EventDetail=strcat(EventType_s,\\\" \\\",Event_s),UserWorker=strcat(UserName_s,\\\"-\\\",Worker_s)\\r\\n| summarize Seconds=sum(Duration_d) by Event=Event_s\\r\\n\\r\\n\",\"size\":0,\"title\":\"Detailed logon data\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Total session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Avg. session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Shortes session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Highest session time in min.\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Logon duration in sec.\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}]},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"EventDetail\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Seconds\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":1}}}}},\"customWidth\":\"100\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},{\"parameterName\":\"Select_SessionsSessionHashOverview\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 7 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Bandwidth and latency\\r\\nBandwidths and latencies the essential metrics indicating an excellent or poor user experience. Typical output bandwidths area between 30kbit/s and several MBit/s depending on the application the users use. If users using browsers, the MBit/s are normal. Latency is a clear indicator of a good experience. The latency should not be higher than hundreds of ms.\\r\\n\\r\\nPart of a Service Level Agreement (SLA) can be the bandwidth and latency. In this case, it's more a trigger for an administrator to check if the network connections have some issues, or to find out what kind of applications requires a high bandwidth usage. \"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average output bandwidth by session host (bit/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Input Session Bandwidth\\\" or Counter_s == \\\"Total Received Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average input bandwidth by session host (bit/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 15\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average latency by session host (ms)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":23}}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 16\"},{\"type\":1,\"content\":{\"json\":\"\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s!=\\\"\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize OutputBandwidth = avg(value_d) by User=UserName_s \\r\\n| order by OutputBandwidth desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average output bandwith by user (bit/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"OutputBandwidth\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":31,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"filter\":true}},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Input Session Bandwidth\\\" or Counter_s == \\\"Total Received Rate\\\") and UserName_s!=\\\"\\\" and Instance_s != \\\"_Server Total\\\" | summarize InputBandwidth = avg(value_d) by User=UserName_s \\r\\n| order by InputBandwidth desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average input bandwith by user (bit/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"InputBandwidth\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":31,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"filter\":true}},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 19\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and UserName_s!=\\\"\\\" and Instance_s != \\\"_Server Total\\\" | summarize Latency = avg(value_d) by User=UserName_s \\r\\n| order by Latency desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average latency by user (ms)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Latency\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"filter\":true}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, bin(TimeGenerated, 3m) | where AggregatedValueS1>8388608 | summarize Count=count() by UserName_s | order by Count desc\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA: Output bandwidth >8MBits/s over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Ex_Sessions_LtBw_User\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, bin(TimeGenerated, 3m) | where AggregatedValueS1>200 | summarize Count=count() by UserName_s | order by Count desc\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA: Latency/RTT>200 ms over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Ex_Sessions_LtBw_User\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"showPin\":true,\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s==\\\"{Ex_Sessions_LtBw_User}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, TimeGenerated\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA bandwidth in bit: Details for {Ex_Sessions_LtBw_User}\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"UserName_s\",\"exportParameterName\":\"Ex_Sessions_Lt_User\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":31,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},{\"parameterName\":\"Ex_Sessions_LtBw_User\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 13 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s==\\\"{Ex_Sessions_LtBw_User}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, TimeGenerated\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA latency: Details for {Ex_Sessions_LtBw_User}\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"UserName_s\",\"exportParameterName\":\"Ex_Sessions_Lt_User\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},{\"parameterName\":\"Ex_Sessions_LtBw_User\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 13 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Applications and users\\r\\n\\r\\nThe relationship between users, applications, and resources is important to be monitored. No longer used, but licensed apps can save money if the license is decreased. An increase of CPU or memory usage of an application after an update can cause a resize of the sizing - even if administrators know the number of users using this app. Running the monitoring over a full year can reveal sessional usage of apps and more.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (ExecutablePath_s has_any (IgnorePath))==false | summarize Count=dcount(UserName_s) by Application=Caption_s | order by Count desc | take 100\",\"size\":0,\"title\":\"Application usage by distinct users\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and (ExecutablePath_s has_any (IgnorePath))==false | summarize Count=dcount(Caption_s) by UserName_s | order by Count desc | take 30\",\"size\":0,\"title\":\"Distinct count of application by users\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"createOtherGroup\":0}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 22\"},{\"type\":1,\"content\":{\"json\":\"The following pie-charts visualize the CPU and memory usage of the applications over the selected timeframe. The values have a synthetic unit showing the summarization of the CPU / memory usage over time and all session hosts. They clearly reveal the applications with the highest impact on CPU and memory (some applications are filtered to avoid showing to much default processes).\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 24\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false | summarize CPU_OverAll=sum(PercentProcessorTime_d) by Application=Caption_s | order by CPU_OverAll desc | take 20\",\"size\":0,\"title\":\"Application CPU consumption (%*min)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and (ExecutablePath_s has_any (IgnorePath))==false  | summarize Memory_OverAll=sum(WorkingSet_d) by Application=Caption_s | order by Memory_OverAll desc | take 20  \",\"size\":0,\"title\":\"Application Memory consumption (Bytes*min)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 24\"},{\"type\":1,\"content\":{\"json\":\"The following tables show the CPU and memory usage of the users running specific applications over the selected timeframe. The values have a synthetic unit showing the summarization of the CPU / memory usage over time by all session hosts. They clearly reveal the users with their applications having the highest impact on CPU and memory (some applications are filtered to avoid showing to much default processes).\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 27\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false\\r\\n| summarize CPU_OverAll=sum(PercentProcessorTime_d) by User=UserName_s,Application=Caption_s | order by CPU_OverAll desc\",\"size\":0,\"title\":\"User and application usage by CPU consumption (%*min)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CPU_OverAll\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 19\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false\\r\\n| summarize Memory_OverAll=sum(WorkingSet_d) by User=UserName_s,Application=Caption_s | order by Memory_OverAll desc\",\"size\":0,\"title\":\"User and application usage by memory consumption (Bytes*min)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Memory_OverAll\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 26\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false and UserInputDelay_d>=0\\r\\n| summarize UserInputDelayMax=max(UserInputDelay_d), UserInputDelayAvg=avg(UserInputDelay_d) by Application=Caption_s\\r\\n| where UserInputDelayAvg>0\\r\\n| order by UserInputDelayMax desc  | take 100\",\"size\":0,\"title\":\"User input delay by application\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"UserInputDelayAvg\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 12 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false and UserInputDelay_d>=0\\r\\n| summarize UserInputDelayMax=max(UserInputDelay_d), UserInputDelayAvg=avg(UserInputDelay_d) by User=UserName_s, Application=Caption_s\\r\\n| where UserInputDelayAvg>0\\r\\n| order by UserInputDelayMax desc  | take 100\",\"size\":0,\"title\":\"User input delay by user and application\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"User\",\"parameterName\":\"Select_UserInputDelayUser\",\"parameterType\":1},{\"fieldName\":\"Application\",\"parameterName\":\"Select_UserInputDelayApp\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"UserInputDelayAvg\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 12 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (UserName_s == \\\"{Select_UserInputDelayUser}\\\") and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Caption_s == \\\"{Select_UserInputDelayApp}\\\"\\r\\n| summarize [\\\"User Input Delay\\\"]=max(UserInputDelay_d) by bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"title\":\"User input delay for {Select_UserInputDelayUser}: {Select_UserInputDelayApp}\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"UserInputDelayAvg\",\"formatter\":0,\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"UserInputDelayMax\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},{\"parameterName\":\"Select_UserInputDelayUser\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 12 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false\\r\\n| summarize Runtime=count(),Path=max(ExecutablePath_s), [\\\"Distinct Users\\\"]=dcount(UserName_s), [\\\"CPU Usage (avg.)\\\"]=avg(PercentProcessorTime_d), [\\\"CPU Usage (P95)\\\"]=percentile(PercentProcessorTime_d,95) by Application=Caption_s\\r\\n| order by Runtime\",\"size\":1,\"title\":\"Application Runtime\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Application\",\"exportParameterName\":\"Select_ApplicationRuntimeApplication\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Runtime\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"CPU Usage (avg.)\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}},{\"columnMatch\":\"CPU Usage (P95)\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}}],\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_number_CPU Usage (P95)_5\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_number_CPU Usage (P95)_5\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 27\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false and Caption_s==\\\"{Select_ApplicationRuntimeApplication}\\\"\\r\\n| summarize Runtime=count(),Path=max(ExecutablePath_s), [\\\"CPU Usage (avg.)\\\"]=avg(PercentProcessorTime_d), [\\\"CPU Usage (P95)\\\"]=percentile(PercentProcessorTime_d,95) by Application=Caption_s, User=UserName_s\\r\\n| order by Runtime\",\"size\":1,\"title\":\"Application Runtime\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Runtime\",\"formatter\":0,\"numberFormat\":{\"unit\":25,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"CPU Usage (avg.)\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}},{\"columnMatch\":\"CPU Usage (P95)\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}}],\"rowLimit\":10000,\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},{\"parameterName\":\"Select_ApplicationRuntimeApplication\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 27 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Application_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Event_s == \\\"crashed\\\" | summarize AggregatedValue = count() by Name_s | order by AggregatedValue desc\",\"size\":1,\"title\":\"Crashed application (#)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"showPin\":true,\"name\":\"query - 27 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Session hosts\\r\\n\\r\\nSession hosts serving the desktops and application for the WVD environment. CPU, memory, and more metrics provide information about performance and scalability.\\r\\n\\r\\nIt's essential that the CPU usage is nearly always lowered than 90% and enough memory free to handle the users' applications.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 47\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" \\r\\n| summarize X=1, Minimum = min(value_d), Average = avg(value_d), Maximum = max(value_d)\\r\\n| take 1\",\"size\":0,\"aggregation\":4,\"title\":\"CPU consumption over all hosts\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"X\",\"yAxis\":[\"Minimum\",\"Maximum\",\"Average\"],\"showLegend\":true,\"xSettings\":{\"min\":1,\"max\":1},\"ySettings\":{\"unit\":1,\"min\":0,\"max\":100}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" \\r\\n| summarize X=1, Minimum = min(value_d), Average = avg(value_d), Maximum = max(value_d)\\r\\n| take 1\",\"size\":0,\"aggregation\":4,\"title\":\"Free memory over all hosts\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"X\",\"yAxis\":[\"Minimum\",\"Maximum\",\"Average\"],\"showLegend\":true,\"xSettings\":{\"min\":1,\"max\":1},\"ySettings\":{\"unit\":2,\"min\":0}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 29\"},{\"type\":1,\"content\":{\"json\":\"## Service Level Agreements\\r\\nPart of a Service Level Agreement (SLA) can be that no longer than three minutes in a row, the CPU usage of each single session host in not higher than 90%. Additionally, free memory should never undercut 600 MByte for longer than three minutes. These values are customizable.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 34\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 3m) | where AggregatedValue>90 | summarize Count=count() by Worker_s | order by Count desc\",\"size\":0,\"aggregation\":2,\"title\":\"Infringement of SLA: CPU usage>90% over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 30\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 3m) | where AggregatedValue<629145600 | summarize Count=count() by Worker_s | order by Count desc\",\"size\":0,\"aggregation\":2,\"title\":\"Infringement of SLA: Free memory<600 Mbytes over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 31\"},{\"type\":1,\"content\":{\"json\":\"## Logon timing\\r\\nThe duration of logon is crucial for the user experience while the users expect it. It's recommended to use FSLogix to provide a fast load/attachment of the user profile to the session host. Additionally, group policy processing and logon scripts can have an impact. The bar chart shows the average duration of different parts of the logon process by session host.\\r\\n\\r\\nFSLogix: Duration of profile attachment and user notification; GPO: Load time of the Group Policy items; GPOExtension: Duration of processing the different GPO extensions (like folder redirection, registry modifications, ...); Script: Duration of running login script(s)\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 34 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Events_CL\\r\\n| where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Trigger_s ==\\\"Logon\\\"\\r\\n| summarize durationSession=sum(Duration_d) by Worker_s, SessionHash_s, EventType_s\\r\\n| summarize Duration=avg(durationSession) by SessionHost=Worker_s, EventType=EventType_s\\r\\n| evaluate pivot(EventType, sum(Duration))\\r\\n| order by SessionHost\",\"size\":0,\"title\":\"Logon timing\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"SessionHost\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Duration\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"xAxis\":\"SessionHost\",\"createOtherGroup\":0,\"ySettings\":{\"numberFormatSettings\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 60\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL|where Category==\\\"Processor Information\\\" and Counter_s==\\\"% Processor Time\\\" and Instance_s==\\\"_Total\\\" and TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) \\r\\n| summarize Runtime=count() by Name_s=Worker_s\\r\\n| join (ITPC_CTX_Worker_CL|summarize max(TimeGenerated) by Name_s,VmSize_s| project Name_s,VmSize_s) on Name_s\\r\\n| extend [\\\"VM Size\\\"]=VmSize_s//\\\"Standard_DS6_v2\\\" \\r\\n| summarize Runtime=sum(Runtime) by  [\\\"VM Size\\\"]\\r\\n| project Runtime,[\\\"VM Size\\\"]\",\"size\":0,\"aggregation\":2,\"title\":\"Session host runtime by VM-type/VM-size\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":25,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 32 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Session distributions\\r\\nMonitoring the distribution of sessions around all session hosts in a host pool can give a hint if something wrong. If one or more session hosts have a significantly lower or higher amount of sessions, a problem in load balancing could happen or that users cannot log on to specific hosts. A host pool load-balanced by depth-first can have an uneven distribution of sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 37\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) | summarize AggregatedValue=dcount(SessionHash_s) by Worker_s | order by AggregatedValue desc\",\"size\":0,\"aggregation\":2,\"title\":\"Top unique sessions by host (#)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 32\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) | summarize AggregatedValue=dcount(SessionHash_s) by Worker_s | order by AggregatedValue asc\",\"size\":0,\"aggregation\":2,\"title\":\"Less unique sessions by host (#)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 33\"},{\"type\":1,\"content\":{\"json\":\"## Core metrics\\r\\nThe following charts are showing the usage of resources by time and session host:\\r\\n* CPU: If a host goes close to 100% over a longer time it can not handle running application or newly started application performantly\\r\\n* Available bytes: Free memory of the hosts to launch new application and server running ones\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 40\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" | summarize AggregatedValue = avg(value_d) by SessionHost=Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":2,\"title\":\"CPU consumption by session host (%)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 34\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":1,\"title\":\"Available bytes by session host (Bytes)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":2}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 35\"},{\"type\":1,\"content\":{\"json\":\"The following charts are showing the usage of resources by time and session host:\\r\\n* Network throughput: Can give a hint if session hosts transmitting a hight data over the network. If this is unexpected, happens periodically or only on a few hosts, a deeper diagnostic could help to find the applications or users causing these\\r\\n* Processor queue length: Should normally be less than than 1. Longer values over 1.5 results in bad user experience\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 43\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Network Adapter\\\" and Counter_s == \\\"Bytes Total/sec\\\" | summarize AggregatedValueS1 = avg(value_d) by Worker_s, Instance_s, bin(TimeGenerated, {_defaultAggBin}) | summarize AggregatedValue=sum(AggregatedValueS1) by Worker_s, TimeGenerated\",\"size\":0,\"aggregation\":3,\"title\":\"Network throughput (Bytes/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":2}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 36\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"System\\\" and Counter_s == \\\"Processor Queue Length\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Processor queue length (#)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 37\"},{\"type\":1,\"content\":{\"json\":\"The following charts are showing the usage of resources by time and session host:\\r\\n* Disk queue length: Should normally be less than than 1. Longer values over one results in bad user experience (applications launches slow, delays with the user interfaces, ...)\\r\\n* Page file usage: If it reaches 100%, no additional virtual memory can be allocated. If there is no free memory available at the same time, the system may crash or freeze\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 46\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"PhysicalDisk\\\" and Counter_s == \\\"Avg. Disk Queue Length\\\" and Instance_s == \\\"_Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Disk queue length (#)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 38\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Category == \\\"Paging File\\\" and Counter_s == \\\"% Usage\\\" and Instance_s == \\\"_Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Page file usage (%)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"showPin\":true,\"name\":\"query - 39\"},{\"type\":1,\"content\":{\"json\":\"## Processes\\r\\nProcesses/applications are the heart of each WVD environment. In addition to the data, they must be brought to the user so that he can perform his tasks. All performance provided by the hosts is for the applications. It's always good to know and to monitor what processes are using what amount of CPU and memory. Even an increase in one of the metrics can be a reference to an upcoming issue.\\r\\n\\r\\nAdditionally, these data can be used to up or downsize an environment based on its needs.\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"text - 49\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. CPU %\\\"] = avg(PercentProcessorTime_d) by Name_s | order by [\\\"Avg. CPU %\\\"] desc\",\"size\":0,\"aggregation\":3,\"title\":\"Process CPU consumption (%)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 40\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. CPU %\\\"] = avg(PercentProcessorTime_d) by Name_s | order by [\\\"Avg. CPU %\\\"] desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process CPU consumption (%)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Avg. CPU %\",\"formatter\":0,\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}},{\"columnMatch\":\"CPU_Average\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":false}}},{\"columnMatch\":\"AggregatedValue\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":true}}}],\"rowLimit\":1000,\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 41\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. Memory usage\\\"] = avg(WorkingSet_d) by Name_s | order by [\\\"Avg. Memory usage\\\"] desc\",\"size\":0,\"aggregation\":3,\"title\":\"Process memory consumption (Bytes)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"chartSettings\":{\"ySettings\":{\"unit\":2}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 42\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. Memory usage\\\"] = avg(WorkingSet_d) by Name_s | order by [\\\"Avg. Memory usage\\\"] desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process memory consumption (Bytes)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Avg. Memory usage\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}}],\"rowLimit\":1000,\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 43\"},{\"type\":1,\"content\":{\"json\":\"Process IO-Data consumption is a metric showing how much data a process is transferring to disk or the network. This data is valuable to identify this kind of application, having a vast IOPS fingerprint.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"text - 54\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. IO throughput\\\"] = avg(IODataBytesPersec_d) by Name_s | order by [\\\"Avg. IO throughput\\\"] desc\",\"size\":0,\"aggregation\":3,\"title\":\"Process IO-Data consumption (Bytes/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOData_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":11,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"CPU_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":false}}},{\"columnMatch\":\"AggregatedValue\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":true}}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 44\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (\\\"{UserSelector}\\\"==\\\"\\\" or UserName_s in ('' {UserSelector})) and (\\\"{SessionHostSelector}\\\"==\\\"\\\" or Worker_s in ('' {SessionHostSelector})) and Name_s != \\\"System Idle Process\\\" | summarize [\\\"Avg. IO throughput\\\"] = avg(IODataBytesPersec_d) by Name_s | order by [\\\"Avg. IO throughput\\\"] desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process IO-Data consumption (Bytes/s)\",\"timeContext\":{\"durationMs\":259200000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Avg. IO throughput\",\"formatter\":0,\"numberFormat\":{\"unit\":11,\"options\":{\"style\":\"decimal\",\"minimumFractionDigits\":1,\"maximumFractionDigits\":1}}}],\"rowLimit\":1000,\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"showPin\":true,\"name\":\"query - 45\"},{\"type\":1,\"content\":{\"json\":\"## Check for updated workbooks\\r\\n\\r\\nThe workbooks for Azure Monitor for WVD are updated to include new visualizations or to integrate features of a new release agent.\\r\\n\\r\\nWorkbook templates:\\r\\nhttp://loganalytics.sepago.com/installation.html#Workbooks\\r\\n\\r\\nAgent download:\\r\\nhttp://loganalytics.sepago.com/download.html\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Updates\"},\"name\":\"text - 67\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"04bf12f3-b1bb-44f5-a4eb-18f19bd6d714\",\"cellValue\":\"lnkMainSelector\",\"linkTarget\":\"step\",\"linkLabel\":\"Top\",\"preText\":\"\",\"style\":\"primary\"}]},\"name\":\"links - 46\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/8be23db5-7929-42cf-b6cf-a82fb248dfb9/resourceGroups/sepago-LogAnalytics/providers/Microsoft.OperationalInsights/workspaces/LATest\"],\"fromTemplateId\":\"ArmTemplates-/subscriptions/8be23db5-7929-42cf-b6cf-a82fb248dfb9/resourceGroups/__LogAnalyticsWorkBookTemplates/providers/microsoft.insights/workbooktemplates/f3c02d9d-aab8-43b6-9eb8-17ae3dfc11ad\"}"
         }
      },
      {
         "name":"cccc906a-c27b-4c5f-9b0e-971751c8c66c",
         "type":"microsoft.insights/workbooktemplates",
         "location": "[parameters('location')]",
         "apiVersion":"2019-10-17-preview",
         "properties":{
            "galleries":[
               {
                  "name":"WVD Fall Classic",
                  "category":"Windows Virtual Desktop",
                  "order":110,
                  "type":"workbook",
                  "resourceType":"microsoft.operationalinsights/workspaces"
               }
            ],
            "templateData":"{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop - Backplane Fall\\r\\nThis workbook gives you an insight into the logs coming from the Windows Virtual Backplane (fall update). These data can be used to resolve issues while user connecting or shows if and when administrative tasks have occurred.\\r\\n\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 0 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\nThe following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. These data are send by the Azure Monitor for WVD Agent from sepago.\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL| where TimeGenerated > ago(5m) \\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s\",\"size\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"showLegend\":true}},\"name\":\"query - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Logins & Connections\",\"subTarget\":\"Logins\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Administration\",\"subTarget\":\"Administration\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Failure statistic\",\"subTarget\":\"Errors\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"se\",\"comparison\":\"isEqualTo\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Type_s =~ \\\"Connection\\\" | summarize Count=count() by State=Outcome_s\",\"size\":1,\"title\":\"Brokered sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL \\r\\n| where TimeGenerated {TimeRange} and Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, TenantId_s, StartTime_t, DesktopGroup_s=toupper(strcat(TenantId_s,\\\".\\\",SessionHostPoolName_s)) \\r\\n| join kind= leftouter (\\r\\n    WVDCheckpointV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g\\r\\n| extend DurationFromLogon=datetime_diff(\\\"Second\\\",Time_t,StartTime_t)\\r\\n| where Name_s=~\\\"RdpStackLogon\\\" \\r\\n| project UserName=UserName_s, Tenant=TenantId_s, HostPool=SessionHostPoolName_s,SessionHost=SessionHostName_s, TimeStamp=StartTime_t , DurationFromLogon, DesktopGroup_s\\r\\n| summarize DurationInSeconds=avg(DurationFromLogon) by HostPool=DesktopGroup_s \",\"size\":1,\"title\":\"Session logon time (s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"User\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientOS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientWvdVersion\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Type_s =~ \\\"Connection\\\" and Outcome_s=~\\\"Failure\\\" |project TimeStamp=TimeGenerated, User=UserName_s, Tenant=TenantId_s, HostPool=SessionHostPoolName_s,ResourceType, SessionHost=SessionHostName_s, ClientOS=ClientOS_s, ClientWvdVersion=ClientVersion_s, Id_g| order by TimeStamp desc\",\"size\":1,\"title\":\"Failed sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Id_g\",\"exportParameterName\":\"_ActivityId\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"User\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientOS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientWvdVersion\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Id_g==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, StartTime_t \\r\\n| join kind= leftouter (\\r\\n    WVDCheckpointV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g\\r\\n| extend DurationFromLogon=Time_t-StartTime_t \\r\\n| project  TimeStamp=Time_t, DurationFromLogon, UserName=UserName_s, Success=Outcome_s=~\\\"Failure\\\", Operation=Name_s, Parameters=Parameters_s, ResourceType ,SessionHost=SessionHostName_s, ActivityId_g, TimeGenerated\\r\\n| order by TimeGenerated desc, TimeStamp asc\",\"size\":1,\"title\":\"Last user logon logs (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and  (Id_g==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, StartTime_t \\r\\n| join kind= leftouter (\\r\\n    WVDErrorV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g \\r\\n| extend DurationFromLogon=Time_t-StartTime_t \\r\\n| project  TimeStamp=Time_t, DurationFromLogon, UserName=UserName_s, ResourceType ,SessionHost=SessionHostName_s, Operations=ErrorOperation_s , ErrorCodeSymbolic=ErrorCodeSymbolic_s , ErrorMessage=ErrorMessage_s, ErrorCode=ErrorCode_s, ErrorSource=ErrorSource_s ,IsInternal=ErrorInternal_s, ReportedBy=ReportedBy_s , ActivityId_g\\r\\n| order by TimeStamp desc\",\"size\":1,\"title\":\"Last user logon errors (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeStamp\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Operations\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorCodeSymbolic\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorMessage\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorCode\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorSource\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IsInternal\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"This log shows how and when administrators made changes in the WVD environment. These contain querying, creating, updating, removing resources. Resource are tenants, host pool, app groups, etc.\\nEven the state of operations is logged: successful or not. Especially, un-successful write-operations can be an indication of an attack.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s =~ \\\"success\\\"\\r\\n| summarize count() by Method_s, Outcome_s\",\"size\":1,\"title\":\"Successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\"\\r\\n| summarize count() by Method_s, Outcome_s\",\"size\":1,\"title\":\"Un-successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} | summarize count() by bin(TimeGenerated,15), Outcome_s\",\"size\":1,\"title\":\"Administrativ read/write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Method_s =~ \\\"update\\\" or Method_s =~ \\\"add\\\" or Method_s =~ \\\"remove\\\" or Method_s =~ \\\"update\\\") and Outcome_s =~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by tostring(Tenant), tostring(HostPool)\\r\\n| order by Tenant, HostPool \",\"size\":1,\"title\":\"Successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Method_s =~ \\\"update\\\" or Method_s =~ \\\"add\\\" or Method_s =~ \\\"remove\\\" or Method_s =~ \\\"update\\\") and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by tostring(Tenant), tostring(HostPool), UserName\\r\\n| order by Tenant, HostPool \",\"size\":1,\"title\":\"Un-successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by UserName, tostring(Tenant), tostring(HostPool)\\r\\n| order by UserName \",\"size\":0,\"title\":\"Un-successful operations (read/write)\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away TenantId, SourceSystem, MG, ManagementGroupName, Computer, RawData, x\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Data table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"The error log is the best place to start troubleshooting of issues like connection problems. The log shows the reason for unsuccessful connection like unhealthy session hosts, session hosts with disabled logons, or hosts have reached their maximum connection count.\\nUnexpected disconnected sessions could be caused by the host, the client, or network issues. Dig deeper into the log to find and eliminate the root cause.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"text - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorCodeSymbolic_s\",\"size\":1,\"title\":\"Errors by reason\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorSource_s\",\"size\":1,\"title\":\"Errors by source\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated, 15m), ErrorCodeSymbolic_s\",\"size\":1,\"title\":\"Errors raised by time\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | project-away TenantId, SourceSystem, MG, ManagementGroupName, Computer, RawData | order by TimeGenerated desc\",\"size\":0,\"title\":\"Errors table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"The checkpoint log shows important steps while brokering connections. It can give a hint about why something happens as it is. It contains information about load balancing user sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Checkpoints\"},\"name\":\"text - 18\"}],\"isLocked\":false}"
         }
      },
      {
         "name":"d4804794-bae3-4f27-afb3-560ccf89d7f6",
         "type":"microsoft.insights/workbooktemplates",
         "location": "[parameters('location')]",
         "apiVersion":"2019-10-17-preview",
         "properties":{
            "galleries":[
               {
                  "name":"WVD ARM API",
                  "category":"Windows Virtual Desktop",
                  "order":105,
                  "type":"workbook",
                  "resourceType":"microsoft.operationalinsights/workspaces"
               }
            ],
            "templateData":"{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop - Backplane Spring\\r\\nThis workbook gives you an insight into the logs coming from the Windows Virtual Backplane (spring update). These data can be used to resolve issues while user connecting or shows if and when administrative tasks have occurred.\\r\\n\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 0 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\nThe following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. These data are send by the Azure Monitor for WVD Agent from sepago.\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL| where TimeGenerated > ago(5m) \\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s\",\"size\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"showLegend\":true}},\"name\":\"query - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Logins & Connections\",\"subTarget\":\"Logins\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Administration\",\"subTarget\":\"Administration\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Failure statistic\",\"subTarget\":\"Errors\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":259200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"se\",\"comparison\":\"isEqualTo\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//This chart shows the number of successful and un-successful brokered sessions by host pools.\\r\\nWVDConnections \\r\\n| where TimeGenerated {TimeRange} and (State ==\\\"Connected\\\" or State == \\\"Started\\\")\\r\\n| extend Multi=split(_ResourceId, \\\"/\\\")\\r\\n| project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHost=SessionHostName , UserName , CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],\\\".\\\", HP=Multi[8])) \\r\\n| order by TimeGenerated desc \\r\\n| summarize StartTime=min(TimeGenerated), max(TimeGenerated) by CorrelationId, User=UserName, HostPool, SessionHost\\r\\n| extend Duration=max_TimeGenerated-StartTime \\r\\n| summarize Failed=countif(Duration==0), Successful=countif(Duration!=0) by HostPool\",\"size\":1,\"title\":\"Brokered sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Failed\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"rightContent\":{\"columnMatch\":\"Failed\"},\"showBorder\":true},\"chartSettings\":{\"xAxis\":\"HostPool\"}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"showPin\":true,\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Duration for the login process from the WVD ARM backend. This includes all steps between clicking the application icon to get notified by the RD agent that the session is established (not for reconnected sessions). \\r\\n// This includes entering the credentials for the session hosts (if not saved). Note: This inculdes re-connected sessions and no failed connections\\r\\nWVDConnections \\r\\n| where TimeGenerated {TimeRange} and (State ==\\\"Connected\\\" or State == \\\"Started\\\")\\r\\n| extend Multi=split(_ResourceId, \\\"/\\\")\\r\\n| project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHost=SessionHostName , UserName , CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],\\\".\\\", HP=Multi[8])) \\r\\n| order by TimeGenerated desc \\r\\n| summarize StartTime=min(TimeGenerated), max(TimeGenerated) by CorrelationId, User=UserName, HostPool, SessionHost\\r\\n| extend Duration=max_TimeGenerated-StartTime | where Duration !=0 \\r\\n| project StartTime, User, HostPool, SessionHost, Duration, CorrelationId\\r\\n| summarize [\\\"Duration in seconds\\\"]=avg(todouble(Duration)/10000000) by HostPool\",\"size\":1,\"title\":\"Session login time (s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true},\"chartSettings\":{\"showMetrics\":false,\"ySettings\":{\"numberFormatSettings\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"showPin\":true,\"name\":\"query - 20 - Copy\"},{\"type\":1,\"content\":{\"json\":\"This chart shows the number of successful and un-successful brokered sessions by host pools.\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"text - 20\"},{\"type\":1,\"content\":{\"json\":\"This chart shows the average login time for users to the host pools. The duration covers all steps between clicking the application icon up to notification of the RD agent that the session is ready. This includes all successful logins and reconnections to sessions.\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"text - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Duration for the login process from the WVD ARM backend. This includes all steps between clicking the application icon to get notified by the RD agent that the session is established (not for reconnected sessions). \\r\\n// This includes entering the credentials for the session hosts (if not saved). Note: This inculdes re-connected sessions and no failed connections\\r\\nWVDConnections \\r\\n| where TimeGenerated {TimeRange} and (State ==\\\"Connected\\\" or State == \\\"Started\\\")\\r\\n| extend Multi=split(_ResourceId, \\\"/\\\")\\r\\n| project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHost=SessionHostName , UserName , CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],\\\".\\\", HP=Multi[8])) \\r\\n| order by TimeGenerated desc \\r\\n| summarize StartTime=min(TimeGenerated), max(TimeGenerated) by CorrelationId, User=UserName, HostPool, SessionHost\\r\\n| extend Duration=max_TimeGenerated-StartTime | where Duration !=0 \\r\\n| project StartTime, CorrelationId, UserName=User, HostPool, SessionHost, Duration\\r\\n| order by StartTime desc\",\"size\":1,\"title\":\"Login durations\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"CorrelationId\",\"exportParameterName\":\"_ActivityId2\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":5000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDCheckpoints | where TimeGenerated {TimeRange} and (CorrelationId==\\\"{_ActivityId2}\\\")\\r\\n| project-away TenantId\\r\\n| order by TimeGenerated desc\\r\\n\",\"size\":1,\"title\":\"Detailed steps for selected login\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},{\"parameterName\":\"_ActivityId2\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors\\r\\n| where TimeGenerated {TimeRange}\\r\\n| project-away TenantId\\r\\n| order by TimeGenerated desc\",\"size\":1,\"title\":\"Failures\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"CorrelationId\",\"exportParameterName\":\"_ActivityId\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDCheckpoints | where TimeGenerated {TimeRange} and (CorrelationId==\\\"{_ActivityId}\\\")\\r\\n| project-away TenantId\\r\\n| order by TimeGenerated desc\\r\\n\",\"size\":1,\"title\":\"Detailed steps for selected failure\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},{\"parameterName\":\"_ActivityId\",\"comparison\":\"isNotEqualTo\"}],\"showPin\":true,\"name\":\"query - 20 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"This log shows how and when administrators made changes in the WVD environment. These contain querying, creating, updating, removing resources. Resource are resource groups, host pool, app groups, etc.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDManagement | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated,15)\",\"size\":1,\"title\":\"Administrativ read/write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDManagement | where TimeGenerated {TimeRange} | extend Multi=split(_ResourceId, \\\"/\\\") | extend ResourceGroup=Multi[4], HostPool=Multi[8], UserName \\r\\n| project-away TenantId, Multi\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Data table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"The error log is the best place to start troubleshooting of issues like connection problems. The log shows the reason for unsuccessful connection like unhealthy session hosts, session hosts with disabled logons, or hosts have reached their maximum connection count.\\nUnexpected disconnected sessions could be caused by the host, the client, or network issues. Dig deeper into the log to find and eliminate the root cause.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"text - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange} | summarize Count=count() by CodeSymbolic\",\"size\":1,\"title\":\"Errors by reason\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorSource_s\",\"size\":1,\"title\":\"Errors by source\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated, 15m), CodeSymbolic\",\"size\":1,\"title\":\"Errors raised by time\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange}\\r\\n| extend Multi=split(_ResourceId, \\\"/\\\") | extend ResourceGroup=Multi[4], HostPool=Multi[8], UserName \\r\\n| project-away TenantId, Multi | order by TimeGenerated desc\",\"size\":0,\"title\":\"Errors table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"The checkpoint log shows important steps while brokering connections. It can give a hint about why something happens as it is. It contains information about load balancing user sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Checkpoints\"},\"name\":\"text - 18\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/dcdce2ee-c9c0-4765-acd5-197126d21978/resourceGroups/WVD_AzureMonitor/providers/Microsoft.OperationalInsights/workspaces/WVD-ITProCloud-ggnpg44xbkxkq\"],\"fromTemplateId\":\"ArmTemplates-/subscriptions/dcdce2ee-c9c0-4765-acd5-197126d21978/resourceGroups/Nerdio-Manager-for-WVD-VMs/providers/microsoft.insights/workbooktemplates/d4804794-bae3-4f27-afb3-560ccf89d7f6\"}"
         }
      }
   ]
}