{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "allowedValues": [
        "eastus",
        "westeurope",
        "southeastasia",
        "australiasoutheast",
        "westcentralus",
        "japaneast"
      ],
      "defaultValue": "westeurope"
    },
    "workspace": {
      "type": "string",
      "defaultValue": "enterAuniqueDnsHostName9y"
    }
  },
  "variables": {
    "workspaceapiversion": "2017-04-26-preview",
    "omsSolutions": {
      "customSolution": {
        "name": "Citrix Super Monitoring",
        "solutionName": "[concat('Citrix Super Monitoring', '[', parameters('workspace'), ']')]",
        "publisher": "marcel.meurer@sepago.de",
        "displayName": "Citrix Super Monitoring",
        "description": "Citrix Super Monitoring Description",
        "author": "marcel.meurer@sepago.de"
      }
    },
	
	  "omsviews": {
		"defailt": [
			"Citrix%20Processes.omsview",
			"Citrix%20Sessions.omsview",
			"Citrix%20Site%20and%20Applications.omsview",
			"Citrix%20Workers.omsview"
		],
		"legacy": [
			"CF%20-%20Etcd.omsview",
			"CF%20-%20Etcd%20Operations.omsview"
		],
		"system_metrics": {
			"oms_agent": "https://raw.githubusercontent.com/Azure/oms-agent-for-linux-boshrelease/master/docs/omsview/Syslog%20and%20Perf.omsview",
			"hm_forwarder": "https://raw.githubusercontent.com/Azure/oms-log-analytics-firehose-nozzle/master/docs/omsview/CF%20KPI%20-%20System%20Metrics.omsview"
		}
	},
	"_omsViewsLocation": {
		"type": "string",
		"defaultValue": "https://raw.githubusercontent.com/MarcelMeurer/LogAnalytics-for-Citrix-and-RDS/master/Views",
		"metadata": {
			"description": "The base URI where OMS views required by this template are located"
		}
	}

  },
  "resources": [




    {
      "apiVersion": "2017-05-10",
      "name": "[replace(replace(variables('omsviews').defailt[copyIndex()], '%20', '_'), '_-_', '-')]",
      "type": "Microsoft.Resources/deployments",
      "copy": {
        "name": "viewCopy",
        "count": "[length(variables('omsviews').defailt)]",
        "mode": "Parallel"
      },
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(variables('_omsViewsLocation'), '/', variables('omsviews').defailt[copyIndex()])]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "workspace": { "value": "[parameters('workspace')]" },
          "location": { "value": "[parameters('location')]" },
          "resourcegroup": { "value": "[resourceGroup().name]" },
          "subscriptionId": { "value": "[subscription().subscriptionId]" },
          "workspaceapiversion": { "value": "[variables('workspaceapiversion')]" }

        }
      }
    }

  ]
}
