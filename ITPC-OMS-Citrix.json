{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "allowedValues": [
        "eastus",
        "westeurope",
        "southeastasia",
        "australiasoutheast",
        "westcentralus",
        "japaneast"
      ],
      "defaultValue": "westeurope"
    },
    "workspace": {
      "type": "string",
      "defaultValue": "enterAuniqueDnsHostName1f"
    }
  },
  "variables": {
    "workspaceapiversion": "2017-04-26-preview",
    "OMSViews": {
      "viewNames": [
        "Citrix%20Processes.omsview",
        "Citrix%20Sessions.omsview",
        "Citrix%20Site%20and%20Applications.omsview",
        "Citrix%20Workers.omsview"
      ]
    }
  },

  "resources": [
      {
        "apiVersion": "[variables('workspaceapiversion')]",
        "name": "[parameters('workspace')]",
        "type": "Microsoft.OperationalInsights/workspaces",
        "location": "[parameters('location')]",
        "properties": {
          "sku": { "Name": "Standalone" },
          "retentionInDays": 360
        }
      },
      {
        "apiVersion": "2017-05-10",
        "name": "[replace(variables('OMSViews').viewNames[copyIndex()], '%20', '_')]",
        "type": "Microsoft.Resources/deployments",
        "copy": {
          "name": "viewCopy",
          "count": "[length(variables('OMSViews').viewNames)]",
          "mode": "Serial"
        },
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[concat('https://raw.githubusercontent.com/MarcelMeurer/LogAnalytics-for-Citrix-and-RDS/master/Views/', variables('OMSViews').viewNames[copyIndex()])]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "workspace": { "value": "[parameters('workspace')]" },
            "location": { "value": "[parameters('location')]" },
            "resourcegroup": { "value": "[resourceGroup().name]" },
            "subscriptionId": { "value": "[subscription().subscriptionId]" },
            "workspaceapiversion": { "value": "[variables('workspaceapiversion')]" }
          }
        }
      }
      ]
    }
